require=function(){function e(t,n,s){function o(i,d){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require,l,r;if(!d&&c)return c(i,!0);if(a)return a(i,!0);throw l=new Error("Cannot find module '"+i+"'"),l.code="MODULE_NOT_FOUND",l}r=n[i]={exports:{}},t[i][0].call(r.exports,function(e){var n=t[i][1][e];return o(n||e)},r,r.exports,e,t,n,s)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<s.length;i++)o(s[i]);return o}return e}()({1:[function(i,c,n){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(s){for(var e,t=1,o=arguments.length,n;t<o;t++){e=arguments[t];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},o.apply(this,arguments)},e,a,r;Object.defineProperty(n,"__esModule",{value:!0}),n.createActionEncoder=n.createActionDecoder=void 0,e=i("./defines");function s(e){return e!==0}a=function(t,n,a){var r=n+a,i=r*t;function c(t){switch(t){case 0:return e.Piece.Empty;case 1:return e.Piece.I;case 2:return e.Piece.L;case 3:return e.Piece.O;case 4:return e.Piece.Z;case 5:return e.Piece.T;case 6:return e.Piece.J;case 7:return e.Piece.S;case 8:return e.Piece.Gray}throw new Error("Unexpected piece")}function l(t){switch(t){case 0:return e.Rotation.Reverse;case 1:return e.Rotation.Right;case 2:return e.Rotation.Spawn;case 3:return e.Rotation.Left}throw new Error("Unexpected rotation")}function d(r,s,o){var i=r%t,c=Math.floor(r/10),a=n-c-1;return s===e.Piece.O&&o===e.Rotation.Left?(i+=1,a-=1):s===e.Piece.O&&o===e.Rotation.Reverse?i+=1:s===e.Piece.O&&o===e.Rotation.Spawn?a-=1:s===e.Piece.I&&o===e.Rotation.Reverse?i+=1:s===e.Piece.I&&o===e.Rotation.Left?a-=1:s===e.Piece.S&&o===e.Rotation.Spawn?a-=1:s===e.Piece.S&&o===e.Rotation.Right?i-=1:s===e.Piece.Z&&o===e.Rotation.Spawn?a-=1:s===e.Piece.Z&&o===e.Rotation.Left&&(i+=1),{x:i,y:a}}return{decode:function(a){var e=a,n,r,u,h,m,f,p,t=c(e%8);return e=Math.floor(e/8),n=l(e%4),e=Math.floor(e/4),r=d(e%i,t,n),e=Math.floor(e/i),u=s(e%2),e=Math.floor(e/2),h=s(e%2),e=Math.floor(e/2),m=s(e%2),e=Math.floor(e/2),f=s(e%2),e=Math.floor(e/2),p=!s(e%2),{rise:u,mirror:h,colorize:m,comment:f,lock:p,piece:o(o({},r),{type:t,rotation:n})}}}},n.createActionDecoder=a;function t(e){return e?1:0}r=function(n,s,o){var i=s+o,a=i*n;function r(r){var t=r.type,o=r.rotation,i=r.x,a=r.y;return(0,e.isMinoPiece)(t)?t===e.Piece.O&&o===e.Rotation.Left?(i-=1,a+=1):t===e.Piece.O&&o===e.Rotation.Reverse?i-=1:t===e.Piece.O&&o===e.Rotation.Spawn?a+=1:t===e.Piece.I&&o===e.Rotation.Reverse?i-=1:t===e.Piece.I&&o===e.Rotation.Left?a+=1:t===e.Piece.S&&o===e.Rotation.Spawn?a+=1:t===e.Piece.S&&o===e.Rotation.Right?i+=1:t===e.Piece.Z&&o===e.Rotation.Spawn?a+=1:t===e.Piece.Z&&o===e.Rotation.Left&&(i-=1):(i=0,a=22),(s-a-1)*n+i}function c(t){var n=t.type,s=t.rotation;if(!(0,e.isMinoPiece)(n))return 0;switch(s){case e.Rotation.Reverse:return 0;case e.Rotation.Right:return 1;case e.Rotation.Spawn:return 2;case e.Rotation.Left:return 3}throw new Error("No reachable")}return{encode:function(n){var u=n.lock,o=n.comment,i=n.colorize,l=n.mirror,d=n.rise,s=n.piece,e=t(!u);return e*=2,e+=t(o),e*=2,e+=t(i),e*=2,e+=t(l),e*=2,e+=t(d),e*=a,e+=r(s),e*=4,e+=c(s),e*=8,e+=s.type,e}}},n.createActionEncoder=r},{"./defines":5}],2:[function(a,i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Buffer=void 0;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(){function e(e){e===void 0&&(e=''),this.values=e.split('').map(o)}return e.prototype.poll=function(o){for(var n=0,s,t=0;t<o;t+=1){if(s=this.values.shift(),s===void 0)throw new Error("Unexpected fumen");n+=s*Math.pow(e.tableLength,t)}return n},e.prototype.push=function(o,t){t===void 0&&(t=1);for(var n=o,s=0;s<t;s+=1)this.values.push(n%e.tableLength),n=Math.floor(n/e.tableLength)},e.prototype.merge=function(n){for(var e=0,t=n.values,s;e<t.length;e++)s=t[e],this.values.push(s)},e.prototype.isEmpty=function(){return this.values.length===0},Object.defineProperty(e.prototype,"length",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.values[e]},e.prototype.set=function(e,t){this.values[e]=t},e.prototype.toString=function(){return this.values.map(n).join('')},e.tableLength=t.length,e}();e.Buffer=s;function o(e){return t.indexOf(e)}function n(e){return t[e]}},{}],3:[function(o,i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createCommentParser=void 0;var t=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",n=t.length+1,s=function(){return{decode:function(i){for(var s='',a,e=i,o=0;o<4;o+=1)a=e%n,s+=t[a],e=Math.floor(e/n);return s},encode:function(e,s){return t.indexOf(e)*Math.pow(n,s)}}};e.createCommentParser=s},{}],4:[function(e,f,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.extract=t.Page=void 0;var i=e("./inner_field"),n,u=e("./buffer"),s=e("./defines"),d=e("./action"),m=e("./comments"),c=e("./quiz"),o=e("./field"),a=function(){function e(e,t,n,s,o,i){this.index=e,this.operation=n,this.comment=s,this.flags=o,this.refs=i,this._field=t.copy()}return Object.defineProperty(e.prototype,"field",{get:function(){return new o.Field(this._field.copy())},set:function(e){this._field=(0,i.createInnerField)(e)},enumerable:!1,configurable:!0}),e.prototype.mino=function(){return o.Mino.from(this.operation)},e}();t.Page=a,n={GarbageLine:1,Width:10};function r(n){var o=function(e,t){var n=t.trim().replace(/[?\s]+/g,'');return{version:e,data:n}},e,s,t=n,i=t.indexOf("&");if(0<=i&&(t=t.substring(0,i)),e=n.match(/[vmd]115@/),e!==void 0&&e!==null&&e.index!==void 0)return s=t.substr(e.index+5),o("115",s);if(e=n.match(/[vmd]110@/),e!==void 0&&e!==null&&e.index!==void 0)return s=t.substr(e.index+5),o("110",s);throw new Error("Unsupported fumen version")}t.extract=r;function h(n){var e=r(n),s=e.version,t=e.data;switch(s){case"115":return l(t,23);case"110":return l(t,21)}throw new Error("Unsupported fumen version")}t.decode=h;function l(H,v){for(P=v+n.GarbageLine,g=P*n.Width,p=new u.Buffer(H),z=function(r){for(var t={changed:!1,field:r},o,a,i,s,c,l,e=0;e<g;){o=p.poll(2),a=Math.floor(o/g),i=o%g,i!==g-1&&(t.changed=!0);for(s=0;s<i+1;s+=1)c=e%n.Width,l=v-Math.floor(e/n.Width)-1,t.field.addNumber(c,l,a-8),e+=1}return t},h=0,j=(0,i.createNewInnerField)(),e={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:''},x=[],N=(0,d.createActionDecoder)(n.Width,v,n.GarbageLine),F=(0,m.createCommentParser)();!p.isEmpty();){if(r=void 0,0<e.repeatCount?(r={field:j,changed:!1},e.repeatCount-=1):(r=z(j.copy()),r.changed||(e.repeatCount=p.poll(1))),L=p.poll(3),t=N.decode(L),l=void 0,t.comment){C=[],E=p.poll(2);for(k=0;k<Math.floor((E+3)/4);k+=1)D=p.poll(5),C.push(D);S='';for(var P,g,p,z,h,j,e,x,N,F,r,L,t,l,C,E,k,D,S,b=0,_=C,T,M,A,O,w,R,f,y;b<_.length;b++)T=_[b],S+=F.decode(T);if(M=unescape(S.slice(0,E)),e.lastCommentText=M,l={text:M},e.refIndex.comment=h,A=l.text,c.Quiz.isQuizComment(A))try{e.quiz=new c.Quiz(A)}catch(t){e.quiz=void 0}else e.quiz=void 0}else h===0?l={text:''}:l={text:e.quiz!==void 0?e.quiz.format().toString():void 0,ref:e.refIndex.comment};if(O=!1,e.quiz!==void 0)if(O=!0,e.quiz.canOperate()&&t.lock)if((0,s.isMinoPiece)(t.piece.type))try{w=e.quiz.nextIfEnd(),R=w.getOperation(t.piece.type),e.quiz=w.operate(R)}catch(t){e.quiz=e.quiz.format()}else e.quiz=e.quiz.format();f=void 0,t.piece.type!==s.Piece.Empty&&(f=t.piece),y=void 0,r.changed||h===0?(y={},e.refIndex.field=h):y={ref:e.refIndex.field},x.push(new a(h,r.field,f!==void 0?o.Mino.from({type:(0,s.parsePieceName)(f.type),rotation:(0,s.parseRotationName)(f.rotation),x:f.x,y:f.y}):void 0,l.text!==void 0?l.text:e.lastCommentText,{quiz:O,lock:t.lock,mirror:t.mirror,colorize:t.colorize,rise:t.rise},{field:y.ref,comment:l.ref})),h+=1,t.lock&&((0,s.isMinoPiece)(t.piece.type)&&r.field.fill(t.piece),r.field.clearLine(),t.rise&&r.field.riseGarbage(),t.mirror&&r.field.mirror()),j=r.field}return x}},{"./action":1,"./buffer":2,"./comments":3,"./defines":5,"./field":7,"./inner_field":8,"./quiz":9}],5:[function(c,l,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseRotation=t.parseRotationName=t.Rotation=t.parsePiece=t.parsePieceName=t.isMinoPiece=t.Piece=void 0;var e,n;(function(e){e[e.Empty=0]="Empty",e[e.I=1]="I",e[e.L=2]="L",e[e.O=3]="O",e[e.Z=4]="Z",e[e.T=5]="T",e[e.J=6]="J",e[e.S=7]="S",e[e.Gray=8]="Gray"})(e=t.Piece||(t.Piece={}));function o(t){return t!==e.Empty&&t!==e.Gray}t.isMinoPiece=o;function i(t){switch(t){case e.I:return"I";case e.L:return"L";case e.O:return"O";case e.Z:return"Z";case e.T:return"T";case e.J:return"J";case e.S:return"S";case e.Gray:return"X";case e.Empty:return"_"}throw new Error("Unknown piece: ".concat(t))}t.parsePieceName=i;function s(t){switch(t.toUpperCase()){case"I":return e.I;case"L":return e.L;case"O":return e.O;case"Z":return e.Z;case"T":return e.T;case"J":return e.J;case"S":return e.S;case"X":case"GRAY":return e.Gray;case" ":case"_":case"EMPTY":return e.Empty}throw new Error("Unknown piece: ".concat(t))}t.parsePiece=s,function(e){e[e.Spawn=0]="Spawn",e[e.Right=1]="Right",e[e.Reverse=2]="Reverse",e[e.Left=3]="Left"}(n=t.Rotation||(t.Rotation={}));function a(e){switch(e){case n.Spawn:return"spawn";case n.Left:return"left";case n.Right:return"right";case n.Reverse:return"reverse"}throw new Error("Unknown rotation: ".concat(e))}t.parseRotationName=a;function r(e){switch(e.toLowerCase()){case"spawn":return n.Spawn;case"left":return n.Left;case"right":return n.Right;case"reverse":return n.Reverse}throw new Error("Unknown rotation: ".concat(e))}t.parseRotation=r},{}],6:[function(t,h,o){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(s){for(var e,t=1,o=arguments.length,n;t<o;t++){e=arguments[t];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},i.apply(this,arguments)},a,s,e,c,l,d,n;Object.defineProperty(o,"__esModule",{value:!0}),o.encode=void 0,a=t("./inner_field"),s=t("./buffer"),e=t("./defines"),c=t("./action"),l=t("./comments"),d=t("./quiz"),n={GarbageLine:1,Width:10};function u(g){for(var y=function(n,i){var e=r(n,i),a=e.changed,t=e.values,c;a?(o.merge(t),u=-1):u<0||o.get(u)===s.Buffer.tableLength-1?(o.merge(t),o.push(0),u=o.length-1):o.get(u)<s.Buffer.tableLength-1&&(c=o.get(u),o.set(u,c+1))},m,_,w,O,u=-1,o=new s.Buffer,f=(0,a.createNewInnerField)(),j=(0,c.createActionEncoder)(n.Width,23,n.GarbageLine),v=(0,l.createCommentParser)(),h='',t=void 0,b=function(w){var n=g[w],k,c,s,p,r,C,A,m,l,S,x,_,b,E,u,O,M;if(n.flags=n.flags?n.flags:{},k=n.field,c=k!==void 0?(0,a.createInnerField)(k):f.copy(),y(f,c),s=n.comment!==void 0?w!==0||n.comment!==''?n.comment:void 0:void 0,p=n.operation!==void 0?{type:(0,e.parsePiece)(n.operation.type),rotation:(0,e.parseRotation)(n.operation.rotation),x:n.operation.x,y:n.operation.y}:{type:e.Piece.Empty,rotation:e.Rotation.Reverse,x:0,y:22},s!==void 0?s.startsWith("#Q=")?t!==void 0&&t.format().toString()===s?r=void 0:(r=s,h=r,t=new d.Quiz(s)):t!==void 0&&t.format().toString()===s?(r=void 0,h=s,t=void 0):(r=h!==s?s:void 0,h=h!==s?r:h,t=void 0):(r=void 0,t=void 0),t!==void 0&&t.canOperate()&&n.flags.lock)if((0,e.isMinoPiece)(p.type))try{C=t.nextIfEnd(),A=C.getOperation(p.type),t=C.operate(A)}catch(e){t=t.format()}else t=t.format();if(m=i({lock:!0,colorize:w===0},n.flags),l={piece:p,rise:!!m.rise,mirror:!!m.mirror,colorize:!!m.colorize,lock:!!m.lock,comment:r!==void 0},S=j.encode(l),o.push(S,3),r!==void 0){x=escape(n.comment),_=Math.min(x.length,4095),o.push(_,2);for(b=0;b<_;b+=4){E=0;for(u=0;u<4;u+=1){if(O=b+u,_<=O)break;M=x.charAt(O),E+=v.encode(M,u)}o.push(E,5)}}else n.comment===void 0&&(h=void 0);l.lock&&((0,e.isMinoPiece)(l.piece.type)&&c.fill(l.piece),c.clearLine(),l.rise&&c.riseGarbage(),l.mirror&&c.mirror()),f=c},p=0;p<g.length;p+=1)b(p);return m=o.toString(),m.length<41?m:(_=[m.substr(0,42)],w=m.substring(42),O=w.match(/[\S]{1,47}/g)||[],_.concat(O).join("?"))}o.encode=u;function r(p,f){for(var h=23,i,a,u=h+1,m=u*n.Width,r=new s.Buffer,c=function(e,n){var t=h-n-1;return f.getNumberAt(e,t)-p.getNumberAt(e,t)+8},l=function(e,t){var n=e*m+t;r.push(n,2)},d=!1,t=c(0,0),e=-1,o=0;o<u;o+=1)for(i=0;i<n.Width;i+=1)a=c(i,o),a!==t?(l(t,e),e=0,t=a,d=!0):e+=1;return l(t,e),{changed:d,values:r}}},{"./action":1,"./buffer":2,"./comments":3,"./defines":5,"./inner_field":8,"./quiz":9}],7:[function(a,c,t){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(s){for(var e,t=1,o=arguments.length,n;t<o;t++){e=arguments[t];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=e[n])}return s},n.apply(this,arguments)},s,e,r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Mino=t.Field=void 0,s=a("./inner_field"),e=a("./defines");function o(e){return e instanceof i?e.copy():i.from(e)}r=function(){function t(e){this.field=e}return t.create=function(e,n){return new t(new s.InnerField({field:e!==void 0?s.PlayField.load(e):void 0,garbage:n!==void 0?s.PlayField.loadMinify(n):void 0}))},t.prototype.canFill=function(e){if(e===void 0)return!0;var t=o(e);return this.field.canFillAll(t.positions())},t.prototype.canLock=function(e){return e===void 0||(!!this.canFill(e)&&!this.canFill(n(n({},e),{y:e.y-1})))},t.prototype.fill=function(s,n){if(n===void 0&&(n=!1),s===void 0)return void 0;var t=o(s);if(!n&&!this.canFill(t))throw Error("Cannot fill piece on field");return this.field.fillAll(t.positions(),(0,e.parsePiece)(t.type)),t},t.prototype.put=function(t){if(t===void 0)return void 0;for(var e=o(t);0<=e.y;e.y-=1){if(!this.canLock(e))continue;return this.fill(e),e}throw Error("Cannot put piece on field")},t.prototype.clearLine=function(){this.field.clearLine()},t.prototype.at=function(t,n){return(0,e.parsePieceName)(this.field.getNumberAt(t,n))},t.prototype.set=function(t,n,s){this.field.setNumberAt(t,n,(0,e.parsePiece)(s))},t.prototype.copy=function(){return new t(this.field.copy())},t.prototype.str=function(e){e===void 0&&(e={});for(var a=e.reduced===void 0||e.reduced,o,n,r=e.separator!==void 0?e.separator:"\n",i=e.garbage===void 0||e.garbage?-1:0,s='',t=22;i<=t;t-=1){o='';for(n=0;n<10;n+=1)o+=this.at(n,t);if(a&&o==="__________")continue;a=!1,s+=o,t!==i&&(s+=r)}return s},t}(),t.Field=r,i=function(){function t(e,t,n,s){this.type=e,this.rotation=t,this.x=n,this.y=s}return t.from=function(e){return new t(e.type,e.rotation,e.x,e.y)},t.prototype.positions=function(){return(0,s.getBlockXYs)((0,e.parsePiece)(this.type),(0,e.parseRotation)(this.rotation),this.x,this.y).sort(function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y})},t.prototype.operation=function(){return{type:this.type,rotation:this.rotation,x:this.x,y:this.y}},t.prototype.isValid=function(){try{(0,e.parsePiece)(this.type),(0,e.parseRotation)(this.rotation)}catch(e){return!1}return this.positions().every(function(e){var t=e.x,n=e.y;return 0<=t&&t<10&&0<=n&&n<23})},t.prototype.copy=function(){return new t(this.type,this.rotation,this.x,this.y)},t}(),t.Mino=i},{"./defines":5,"./inner_field":8}],8:[function(c,p,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getPieces=n.getBlocks=n.getBlockXYs=n.getBlockPositions=n.PlayField=n.InnerField=n.createInnerField=n.createNewInnerField=void 0;var t=c("./defines"),o,i,e={Width:10,Height:23,PlayBlocks:23*10};function u(){return new o({})}n.createNewInnerField=u;function l(a){for(var i=new o({}),s,r,n=-1;n<e.Height;n+=1)for(s=0;s<e.Width;s+=1)r=a.at(s,n),i.setNumberAt(s,n,(0,t.parsePiece)(r));return i}n.createInnerField=l,o=function(){function n(t){var s=t.field,i=s===void 0?n.create(e.PlayBlocks):s,o=t.garbage,a=o===void 0?n.create(e.Width):o;this.field=i,this.garbage=a}return n.create=function(e){return new i({length:e})},n.prototype.fill=function(e){this.field.fill(e)},n.prototype.fillAll=function(e,t){this.field.fillAll(e,t)},n.prototype.canFill=function(n,s,o,i){var r=this,c=a(n,s,o,i);return c.every(function(o){var n=o[0],s=o[1];return 0<=n&&n<10&&0<=s&&s<e.Height&&r.getNumberAt(n,s)===t.Piece.Empty})},n.prototype.canFillAll=function(n){var s=this;return n.every(function(i){var n=i.x,o=i.y;return 0<=n&&n<10&&0<=o&&o<e.Height&&s.getNumberAt(n,o)===t.Piece.Empty})},n.prototype.isOnGround=function(e,t,n,s){return!this.canFill(e,t,n,s-1)},n.prototype.clearLine=function(){this.field.clearLine()},n.prototype.riseGarbage=function(){this.field.up(this.garbage),this.garbage.clearAll()},n.prototype.mirror=function(){this.field.mirror()},n.prototype.shiftToLeft=function(){this.field.shiftToLeft()},n.prototype.shiftToRight=function(){this.field.shiftToRight()},n.prototype.shiftToUp=function(){this.field.shiftToUp()},n.prototype.shiftToBottom=function(){this.field.shiftToBottom()},n.prototype.copy=function(){return new n({field:this.field.copy(),garbage:this.garbage.copy()})},n.prototype.equals=function(e){return this.field.equals(e.field)&&this.garbage.equals(e.garbage)},n.prototype.addNumber=function(t,e,n){0<=e?this.field.addOffset(t,e,n):this.garbage.addOffset(t,-(e+1),n)},n.prototype.setNumberFieldAt=function(e,t){this.field.setAt(e,t)},n.prototype.setNumberGarbageAt=function(e,t){this.garbage.setAt(e,t)},n.prototype.setNumberAt=function(t,e,n){return 0<=e?this.field.set(t,e,n):this.garbage.set(t,-(e+1),n)},n.prototype.getNumberAt=function(t,e){return 0<=e?this.field.get(t,e):this.garbage.get(t,-(e+1))},n.prototype.getNumberAtIndex=function(e,t){return t?this.getNumberAt(e%10,Math.floor(e/10)):this.getNumberAt(e%10,-(Math.floor(e/10)+1))},n.prototype.toFieldNumberArray=function(){return this.field.toArray()},n.prototype.toGarbageNumberArray=function(){return this.garbage.toArray()},n}(),n.InnerField=o,i=function(){function n(n){var s=n.pieces,o=n.length,i=o===void 0?e.PlayBlocks:o;s!==void 0?this.pieces=s:this.pieces=Array.from({length:i}).map(function(){return t.Piece.Empty}),this.length=i}return n.load=function(){for(var t=[],s,e=0;e<arguments.length;e++)t[e]=arguments[e];return s=t.join('').trim(),n.loadInner(s)},n.loadMinify=function(){for(var t=[],s,e=0;e<arguments.length;e++)t[e]=arguments[e];return s=t.join('').trim(),n.loadInner(s,s.length)},n.loadInner=function(i,s){var o=s!==void 0?s:i.length,a,e,r;if(o%10!==0)throw new Error("Num of blocks in field should be mod 10");a=s!==void 0?new n({length:s}):new n({});for(e=0;e<o;e+=1)r=i[e],a.set(e%10,Math.floor((o-e-1)/10),(0,t.parsePiece)(r));return a},n.prototype.get=function(t,n){return this.pieces[t+n*e.Width]},n.prototype.addOffset=function(t,n,s){this.pieces[t+n*e.Width]+=s},n.prototype.set=function(t,n,s){this.setAt(t+n*e.Width,s)},n.prototype.setAt=function(e,t){this.pieces[e]=t},n.prototype.fill=function(e){for(var n=e.type,l=e.rotation,d=e.x,r=e.y,o,c=s(n,l),t=0,a=c;t<a.length;t++){o=a[t];var i=[d+o[0],r+o[1]],u=i[0],h=i[1];this.set(u,h,n)}},n.prototype.fillAll=function(s,o){for(e=0,t=s;e<t.length;e++){var e,t,n=t[e],i=n.x,a=n.y;this.set(i,a,o)}},n.prototype.clearLine=function(){for(var s=this.pieces.concat(),i,a,r,c,o=this.pieces.length/e.Width-1,n=o;0<=n;n-=1)i=this.pieces.slice(n*e.Width,(n+1)*e.Width),a=i.every(function(e){return e!==t.Piece.Empty}),a&&(r=s.slice(0,n*e.Width),c=s.slice((n+1)*e.Width),s=r.concat(c,Array.from({length:e.Width}).map(function(){return t.Piece.Empty})));this.pieces=s},n.prototype.up=function(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)},n.prototype.mirror=function(){s=[];for(t=0;t<this.pieces.length;t+=1){o=this.pieces.slice(t*e.Width,(t+1)*e.Width),o.reverse();for(var s,t,o,n=0,i=o,a;n<i.length;n++)a=i[n],s.push(a)}this.pieces=s},n.prototype.shiftToLeft=function(){for(var o=this.pieces.length/10,s,n=0;n<o;n+=1){for(s=0;s<e.Width-1;s+=1)this.pieces[s+n*e.Width]=this.pieces[s+1+n*e.Width];this.pieces[9+n*e.Width]=t.Piece.Empty}},n.prototype.shiftToRight=function(){for(var o=this.pieces.length/10,s,n=0;n<o;n+=1){for(s=e.Width-1;1<=s;s-=1)this.pieces[s+n*e.Width]=this.pieces[s-1+n*e.Width];this.pieces[n*e.Width]=t.Piece.Empty}},n.prototype.shiftToUp=function(){var e=Array.from({length:10}).map(function(){return t.Piece.Empty});this.pieces=e.concat(this.pieces).slice(0,this.length)},n.prototype.shiftToBottom=function(){var e=Array.from({length:10}).map(function(){return t.Piece.Empty});this.pieces=this.pieces.slice(10,this.length).concat(e)},n.prototype.toArray=function(){return this.pieces.concat()},Object.defineProperty(n.prototype,"numOfBlocks",{get:function(){return this.pieces.length},enumerable:!1,configurable:!0}),n.prototype.copy=function(){return new n({pieces:this.pieces.concat(),length:this.length})},n.prototype.toShallowArray=function(){return this.pieces},n.prototype.clearAll=function(){this.pieces=this.pieces.map(function(){return t.Piece.Empty})},n.prototype.equals=function(t){if(this.pieces.length!==t.pieces.length)return!1;for(var e=0;e<this.pieces.length;e+=1)if(this.pieces[e]!==t.pieces[e])return!1;return!0},n}(),n.PlayField=i;function a(e,t,n,o){return s(e,t).map(function(e){return e[0]+=n,e[1]+=o,e})}n.getBlockPositions=a;function d(e,t,n,o){return s(e,t).map(function(e){return{x:e[0]+n,y:e[1]+o}})}n.getBlockXYs=d;function s(n,s){var e=r(n);switch(s){case t.Rotation.Spawn:return e;case t.Rotation.Left:return h(e);case t.Rotation.Reverse:return f(e);case t.Rotation.Right:return m(e)}throw new Error("Unsupported block")}n.getBlocks=s;function r(e){switch(e){case t.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case t.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case t.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case t.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case t.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case t.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case t.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new Error("Unsupported rotation")}n.getPieces=r;function m(e){return e.map(function(e){return[e[1],-e[0]]})}function h(e){return e.map(function(e){return[-e[1],e[0]]})}function f(e){return e.map(function(e){return[-e[0],-e[1]]})}},{"./defines":5}],9:[function(s,i,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Quiz=void 0;var t=s("./defines"),e,o;(function(e){e.Direct="direct",e.Swap="swap",e.Stock="stock"})(e||(e={})),o=function(){function n(e){this.quiz=n.verify(e)}return Object.defineProperty(n.prototype,"next",{get:function(){var t=this.quiz.indexOf(")")+1,e=this.quiz[t];return e===void 0||e===";"?'':e},enumerable:!1,configurable:!0}),n.isQuizComment=function(e){return e.startsWith("#Q=")},n.create=function(e,t){var s=function(s,t){var e=function(e){return e||''};return new n("#Q=[".concat(e(s),"](").concat(e(t[0]),")").concat(e(t.substring(1))))};return t!==void 0?s(e,t):s(void 0,e)},n.trim=function(e){return e.trim().replace(/\s+/g,'')},Object.defineProperty(n.prototype,"least",{get:function(){var e=this.quiz.indexOf(")");return this.quiz.substr(e+1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"current",{get:function(){var t=this.quiz.indexOf("(")+1,e=this.quiz[t];return e===")"?'':e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hold",{get:function(){var t=this.quiz.indexOf("[")+1,e=this.quiz[t];return e==="]"?'':e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leastAfterNext2",{get:function(){var e=this.quiz.indexOf(")");return this.quiz[e+1]===";"?this.quiz.substr(e+1):this.quiz.substr(e+2)},enumerable:!1,configurable:!0}),n.prototype.getOperation=function(i){var n=(0,t.parsePieceName)(i),o,s=this.current;if(n===s)return e.Direct;if(o=this.hold,n===o)return e.Swap;if(o===''){if(n===this.next)return e.Stock}else if(s===''&&n===this.next)return e.Direct;throw new Error("Unexpected hold piece in quiz: ".concat(this.quiz))},Object.defineProperty(n.prototype,"leastInActiveBag",{get:function(){var n=this.quiz.indexOf(";"),e=0<=n?this.quiz.substring(0,n):this.quiz,t=e.indexOf(")");return e[t+1]===";"?e.substr(t+1):e.substr(t+2)},enumerable:!1,configurable:!0}),n.verify=function(e){var t=this.trim(e);if(t.length===0||e==="#Q=[]()"||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*;?.*$/i))throw new Error("Current piece doesn't exist, however next pieces exist: ".concat(e));return t},n.prototype.direct=function(){if(this.current===''){var e=this.leastAfterNext2;return new n("#Q=[".concat(this.hold,"](").concat(e[0],")").concat(e.substr(1)))}return new n("#Q=[".concat(this.hold,"](").concat(this.next,")").concat(this.leastAfterNext2))},n.prototype.swap=function(){if(this.hold==='')throw new Error("Cannot find hold piece: ".concat(this.quiz));var e=this.next;return new n("#Q=[".concat(this.current,"](").concat(e,")").concat(this.leastAfterNext2))},n.prototype.stock=function(){if(this.hold!==''||this.next==='')throw new Error("Cannot stock: ".concat(this.quiz));var e=this.leastAfterNext2,t=e[0]!==void 0?e[0]:'';return 1<e.length?new n("#Q=[".concat(this.current,"](").concat(t,")").concat(e.substr(1))):new n("#Q=[".concat(this.current,"](").concat(t,")"))},n.prototype.operate=function(t){switch(t){case e.Direct:return this.direct();case e.Swap:return this.swap();case e.Stock:return this.stock()}throw new Error("Unexpected operation")},n.prototype.format=function(){var e=this.nextIfEnd(),o,i,t,s;return e.quiz==="#Q=[]()"?new n(''):(o=e.current,i=e.hold,o===''&&i!=='')?new n("#Q=[](".concat(i,")").concat(e.least)):o===''?(t=e.least,s=t[0],s===void 0)?new n(''):s===";"?new n(t.substr(1)):new n("#Q=[](".concat(s,")").concat(t.substr(1))):e},n.prototype.getHoldPiece=function(){if(!this.canOperate())return t.Piece.Empty;var e=this.hold;return e===void 0||e===''||e===";"?t.Piece.Empty:(0,t.parsePiece)(e)},n.prototype.getNextPieces=function(e){if(!this.canOperate())return e!==void 0?Array.from({length:e}).map(function(){return t.Piece.Empty}):[];var n=(this.current+this.next+this.leastInActiveBag).substr(0,e);return e!==void 0&&n.length<e&&(n+=" ".repeat(e-n.length)),n.split('').map(function(e){return e===void 0||e===" "||e===";"?t.Piece.Empty:(0,t.parsePiece)(e)})},n.prototype.toString=function(){return this.quiz},n.prototype.canOperate=function(){var e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&e!=="#Q=[]()"},n.prototype.nextIfEnd=function(){return this.quiz.startsWith("#Q=[]();")?new n(this.quiz.substr(8)):this},n}(),n.Quiz=o},{"./defines":5}],hashmap:[function(t,e){(function(t){if(typeof define=="function"&&define.amd)define([],t);else if(typeof e=="object"){var n=e.exports=t();n.HashMap=n}else this.HashMap=t()})(function(){function e(e){switch(this.clear(),arguments.length){case 0:break;case 1:{"length"in e?n(this,Array.prototype.concat.apply([],e)):this.copy(e);break}default:n(this,arguments);break}}var t=e.prototype={constructor:e,get:function(t){var e=this._data[this.hash(t)];return e&&e[1]},set:function(e,n){var t=this.hash(e);t in this._data||this.size++,this._data[t]=[e,n]},multi:function(){n(this,arguments)},copy:function(t){for(var e in t._data)e in this._data||this.size++,this._data[e]=t._data[e]},has:function(e){return this.hash(e)in this._data},search:function(t){for(var e in this._data)if(this._data[e][1]===t)return this._data[e][0];return null},delete:function(t){var e=this.hash(t);e in this._data&&(this.size--,delete this._data[e])},type:function(e){var n=Object.prototype.toString.call(e),t=n.slice(8,-1).toLowerCase();return!e&&(t==="domwindow"||t==="window")?e+'':t},keys:function(){var e=[];return this.forEach(function(n,t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),e},count:function(){return this.size},clear:function(){this._data={},this.size=0},clone:function(){return new e(this)},hash:function(t){switch(this.type(t)){case"undefined":case"null":case"boolean":case"number":case"regexp":return t+'';case"date":return"♣"+t.getTime();case"string":return"♠"+t;case"array":for(var o=[],n=0;n<t.length;n++)o[n]=this.hash(t[n]);return"♥"+o.join("⁞");default:return t.hasOwnProperty("_hmuid_")||(t._hmuid_=++e.uid,s(t,"_hmuid_")),"♦"+t._hmuid_}},forEach:function(t,n){for(s in this._data){var s,e=this._data[s];t.call(n||this,e[1],e[0])}}};e.uid=0,typeof Symbol!="undefined"&&typeof Symbol.iterator!="undefined"&&(t[Symbol.iterator]=function(){var e=this.entries(),t=0;return{next:function(){if(t===e.length)return{done:!0};var n=e[t++];return{value:{key:n[0],value:n[1]},done:!1}}}}),["set","multi","copy","delete","clear","forEach"].forEach(function(e){var n=t[e];t[e]=function(){return n.apply(this,arguments),this}}),e.prototype.remove=e.prototype.delete;function n(n,t){for(var e=0;e<t.length;e+=2)n.set(t[e],t[e+1])}function s(e,t){Object.defineProperty&&Object.defineProperty(e,t,{enumerable:!1})}return e})},{}],"tetris-fumen":[function(t,i,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.encoder=e.decoder=e.Mino=e.Field=void 0;var s=t("./lib/decoder"),o=t("./lib/encoder"),n=t("./lib/field");Object.defineProperty(e,"Field",{enumerable:!0,get:function(){return n.Field}}),Object.defineProperty(e,"Mino",{enumerable:!0,get:function(){return n.Mino}}),e.decoder={decode:function(e){return(0,s.decode)(e)}},e.encoder={encode:function(e){return"v115@".concat((0,o.encode)(e))}}},{"./lib/decoder":4,"./lib/encoder":6,"./lib/field":7}]},{},[])