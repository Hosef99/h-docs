const{decoder}=require("tetris-fumen");var colors={I:{normal:"#41afde",highlight1:"#3dc0fb",highlight2:"#3dc0fb",lighter:"#3dc0fb",light:"#43d3ff"},T:{normal:"#b451ac",highlight1:"#d161c9",highlight2:"#d161c9",lighter:"#d161c9",light:"#e56add"},S:{normal:"#66c65c",highlight1:"#75d96a",highlight2:"#7cd97a",lighter:"#7cd97a",light:"#88ee86"},Z:{normal:"#ef624d",highlight1:"#ff7866",highlight2:"#ff8778",lighter:"#fd7660",light:"#ff9484"},L:{normal:"#ef9535",highlight1:"#ffa94d",highlight2:"#ffae58",lighter:"#fea440",light:"#ffbf60"},J:{normal:"#1983bf",highlight1:"#1997e3",highlight2:"#1997e3",lighter:"#1997e3",light:"#1ba6f9"},O:{normal:"#f7d33e",highlight1:"#ffe34b",highlight2:"#ffe34b",lighter:"#ffe34b",light:"#fff952"},X:{normal:"#bbbbbb",highlight1:"#686868",highlight2:"#686868",lighter:"#bbbbbb",light:"#cccccc"},Empty:{normal:"#f3f3ed"}},cellSize=22,transparency_four=!0,gridToggle=!1,numcols=10;function draw(l,e,o,h,a){var s=l.field,r,d=l.operation;function u(e){return i==e.x&&j==e.y}if(o==void 0){o=0;for(i=0;i<numcols;i++)for(j=0;j<23;j++)s.at(i,j)!="_"&&(o=Math.max(o,j)),d!=void 0&&d.positions().filter(u).length>0&&(o=Math.max(o,j));o+=2}const c=e*numcols,n=o*e;r=document.createElement("canvas"),r.width=c,r.height=n;const t=r.getContext("2d");if(h?t.fillStyle="rgba(0, 0, 0, 0)":t.fillStyle=document.getElementById("bg").value,t.fillRect(0,0,c,n),gridToggle){t.strokeStyle=a,t.strokeRect(0,0,c,n);for(i=0;i<numcols;i++)for(j=0;j<o;j++)t.fillStyle=a+"30",t.fillRect(i*e,n-(j+1)*e,1,e),t.fillRect(i*e,n-(j+1)*e,e,1)}for(i=0;i<numcols;i++)for(j=0;j<o;j++)s.at(i,j)!="_"&&(t.fillStyle=colors[s.at(i,j)].normal,t.fillRect(i*e,n-(j+1)*e,e,e),gridToggle&&(t.fillStyle=a+"40",t.fillRect(i*e,n-(j+1)*e,1,e),t.fillRect(i*e,n-(j+1)*e,e,1),t.fillRect((i+1)*e,n-(j+1)*e,1,e),t.fillRect(i*e,n-j*e,e,1)),s.at(i,j+1)=="_"&&(t.fillStyle=colors[s.at(i,j)].light,t.fillRect(i*e,n-(j+1)*e-e/5,e,e/5),gridToggle&&(t.fillStyle=a+"CC",t.fillRect(i*e,n-(j+1)*e-e/5,e,1),s.at(Math.max(0,i-1),j+1)=="_"?(t.fillStyle=a+"CC",t.fillRect(i*e,n-(j+1)*e-e/5,1,e/5)):(t.fillStyle=a+"FF",t.fillRect(i*e,n-(j+1)*e-e/5,1,e/5)),s.at(i+1,j+1)=="_"&&(t.fillStyle=a+"CC",t.fillRect((i+1)*e,n-(j+1)*e-e/5,1,e/5)))),gridToggle&&(t.fillStyle=a+"FF",s.at(Math.max(i-1,0),j)=="_"&&t.fillRect(i*e,n-(j+1)*e,1,e+1),s.at(i,j+1)=="_"&&t.fillRect(i*e,n-(j+1)*e,e+1,1),s.at(i+1,j)=="_"&&t.fillRect((i+1)*e,n-(j+1)*e,1,e+1),s.at(i,j-1)=="_"&&t.fillRect(i*e,n-j*e,e+1,1)));return r}function fumencanvas(e){var s=e.innerHTML,o,i,n,a,t;e.innerHTML='',o=void 0,i="#ffffff",n=[];for(let e of s.split("	"))n.push(...e.split(/\s/));for(let s of n)try{a=decoder.decode(s),canvas=draw(a[0],cellSize,o,transparency_four,i),t=document.createElement("img"),t.src=canvas.toDataURL("image/png"),t.className="imageOutput",e.appendChild(t)}catch(e){console.log(s,e)}}function formatFumen(){let e=document.getElementsByTagName("fumen");Array.from(e).forEach(e=>fumencanvas(e))}window.addEventListener("million:navigate",formatFumen),window.addEventListener("DOMContentLoaded",formatFumen)